<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #map {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }
        </style>
        <title></title>
    
        <style>
        /* ECO MAP - UI */
        #logo-ecomap{
            position: absolute;
            left: 14px;
            bottom: 14px;
            z-index: 9999;
            pointer-events: none;
        }
        #logo-ecomap img{
            width: 120px; /* ~40% menor (ajuste fino se necess√°rio) */
            height: auto;
            display:block;
        }

        #map-title{
            position:absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            background: rgba(255,255,255,0.92);
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: 6px;
            padding: 7px 14px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 18px;
            font-weight: 700;
            line-height: 1.15;
            max-width: calc(100vw - 120px);
            text-align:center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        #legend-declividade{
            position:absolute;
            left: 14px;
            bottom: 160px; /* fallback; JS recalcula para n√£o sobrepor o logo */
            z-index: 9999;
            background: rgba(255,255,255,0.95);
            border: 1px solid rgba(0,0,0,0.10);
            border-radius: 6px;
            padding: 8px 10px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            display:none;
            min-width: 120px;
        }
        #legend-declividade .legend-header{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap: 10px;
            margin-bottom: 6px;
        }
        #legend-declividade .legend-title{
            font-weight: 700;
            margin: 0;
        }
        #legend-declividade .legend-toggle{
            width: 26px;
            height: 22px;
            line-height: 18px;
            text-align:center;
            border: 1px solid rgba(0,0,0,0.15);
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            user-select: none;
            font-weight: 700;
            padding: 0;
        }
        #legend-declividade .legend-toggle:hover{
            background: #f4f4f4;
        }
        #legend-declividade .legend-body{
            display:block;
        }
        #legend-declividade table{
            border-collapse: collapse;
        }
      #legend-declividade td{
  padding: 3px 8px 3px 0;
}

#legend-declividade td.label{
  padding-left: 8px; /* espa√ßo entre cor e texto */
}

        #legend-declividade td.swatch{
            width: 22px;
            height: 14px;
            border: 1px solid rgba(0,0,0,0.15);
            padding: 0;
        }/* Bot√£o Home (casinha) com apar√™ncia Leaflet */
        .leaflet-control-custom-home{
            background: #fff;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            cursor: pointer;
            font-size: 16px;
        }
        .leaflet-control-custom-home:hover{
            background: #f4f4f4;
        }

        /* MOBILE */
        @media (max-width: 768px){
            #map-title{
                top: 8px;
                font-size: 14px;
                padding: 6px 10px;
                max-width: calc(100vw - 20px);
            }
            #logo-ecomap{
                left: 10px;
                bottom: 10px;
            }
            #logo-ecomap img{
                width: 95px;
            }
            #legend-declividade{
                left: 10px;
                bottom: 120px;
                font-size: 11px;
                padding: 7px 9px;
            }

            /* evita sobreposi√ß√£o com t√≠tulo: empurra controles um pouco para baixo */
            .leaflet-top.leaflet-left{
                top: 54px;
            }

            /* painel de camadas com melhor uso em mobile */
            .leaflet-control-layers{
                max-height: 70vh;
                overflow: auto;
            }
            .leaflet-control-layers-tree{
                max-height: 70vh;
                overflow: auto;
            }
        }
        
        /* ===== COMERCIAL: bot√£o de v√≠deo nos lotes ===== */
        .lote-video-btn button{
            background: #ffffff;
            border: 2px solid #1e88e5;
            border-radius: 18px;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        }
        .lote-video-btn button:hover{
            background: #1e88e5;
            color: #fff;
        }

        /* ===== Modal de v√≠deo (YouTube embed) ===== */
        #videoModal{
            position: fixed;
            inset: 0;
            z-index: 20000;
            display: none;
        }
        #videoModal .video-modal-backdrop{
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.55);
        }
        #videoModal .video-modal-box{
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%,-50%);
            width: min(900px, 92vw);
            height: min(520px, 70vh);
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.25);
            display: flex;
            flex-direction: column;
            font-family: Arial, Helvetica, sans-serif;
        }
        #videoModal .video-modal-header{
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid rgba(0,0,0,0.10);
        }
        #videoModalTitle{
            font-weight: 700;
        }
        #videoModalClose{
            width: 34px;
            height: 34px;
            border: 1px solid rgba(0,0,0,0.15);
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            font-size: 20px;
            line-height: 30px;
        }
        #videoModalClose:hover{
            background: #f4f4f4;
        }
        #videoModal .video-modal-content{
            flex: 1;
        }
        #videoModalFrame{
            width: 100%;
            height: 100%;
            border: 0;
        }
</style>


<style id="ecomap-mobile-dashboard-css">
/* Dashboard (canto inferior direito) */
.ecomap-dashboard{
  position: fixed;
  right: 14px;
  bottom: 14px;
  z-index: 2500;
  width: 280px;
  max-width: calc(100vw - 24px);
  background: rgba(255,255,255,0.95);
  border: 1px solid rgba(0,0,0,0.12);
  border-radius: 10px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.18);
  font-family: Arial, Helvetica, sans-serif;
}
.ecomap-dashboard .dash-header{
  display:flex; align-items:center; justify-content:space-between;
  padding: 8px 10px;
  border-bottom: 1px solid rgba(0,0,0,0.10);
  font-weight: 700;
  font-size: 13px;
}
.ecomap-dashboard .dash-toggle{
  cursor:pointer;
  border: 0;
  background: #f3f4f6;
  border-radius: 6px;
  width: 28px; height: 24px;
  font-weight: 700;
}
.ecomap-dashboard .dash-body{ padding: 10px; }
.ecomap-dashboard .dash-btn{
  display:block;
  width:100%;
  padding: 10px 12px;
  margin: 8px 0;
  border-radius: 8px;
  border: 0;
  cursor: pointer;
  font-weight: 700;
  font-size: 13px;
  background: #253649;
  color: #fff;
}
.ecomap-dashboard .dash-btn.secondary{ background:#1f2d3d; }
.ecomap-dashboard .dash-btn:active{ transform: translateY(1px); }
.ecomap-dashboard.collapsed .dash-body{ display:none; }

/* Ajuste para n√£o colidir com atribui√ß√£o (qgis2web/Leaflet) */
.leaflet-control-attribution{ max-width: 55vw; }

/* Legenda declividade acima das logos */
#legend-declividade{
  position: fixed;
  left: 14px;
  bottom: 190px; /* acima das logos */
  z-index: 2400;
}
#legend-declividade .legend-header{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom: 6px;
  font-weight: 700;
}
#legend-declividade .legend-toggle{
  cursor:pointer;
  border: 0;
  background: #f3f4f6;
  border-radius: 6px;
  width: 28px; height: 24px;
  font-weight: 700;
}
@media (max-width: 768px){
  #legend-declividade{ bottom: 210px; left: 10px; }
  .ecomap-dashboard{ right: 10px; bottom: 10px; width: 250px; }
}
</style>

</head>
    <body>
        
        <!-- ECO MAP - overlays -->
        <div id="map-title">Loteamento Novo Orlando</div>

        <div id="legend-declividade" aria-hidden="true">
            <div class="legend-header">
                <div class="legend-title">Declividade</div>
                <button id="legend-toggle" type="button" class="legend-toggle" title="Minimizar">‚Äì</button>
            </div>
            <div id="legend-body" class="legend-body">
            <table>
  <tr>
    <td class="swatch" style="background:#3cb44b;"></td>
    <td class="label">0 ‚Äì 8 %</td>
  </tr>
  <tr>
    <td class="swatch" style="background:#ffe119;"></td>
    <td class="label">8 ‚Äì 20 %</td>
  </tr>
  <tr>
    <td class="swatch" style="background:#f58231;"></td>
    <td class="label">20 ‚Äì 30 %</td>
  </tr>
  <tr>
    <td class="swatch" style="background:#e6194B;"></td>
    <td class="label">30 ‚Äì 45 %</td>
  </tr>
</table>

            </div>
        </div>

        <div id="logo-ecomap">
            <img src="images/logo_combinado.png" alt="Logo">
        </div>
        <!-- /ECO MAP - overlays -->

        <!-- Modal de v√≠deo (Comercial) -->
        <div id="videoModal" aria-hidden="true">
            <div class="video-modal-backdrop"></div>
            <div class="video-modal-box" role="dialog" aria-modal="true">
                <div class="video-modal-header">
                    <div id="videoModalTitle">Vista do lote</div>
                    <button id="videoModalClose" type="button" aria-label="Fechar">√ó</button>
                </div>
                <div class="video-modal-content">
                    <iframe id="videoModalFrame" src="" allow="autoplay; fullscreen" allowfullscreen></iframe>
                </div>
            </div>
        </div>
        <!-- /Modal de v√≠deo -->

<div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="data/BaciaRioSantaCruz_2.js"></script>
        <script src="data/Cursosdgua_3.js"></script>
        <script src="data/VegetaoAtual_4.js"></script>
        <script src="data/APP_5.js"></script>
        <script src="data/readeSupressodeVegetao_6.js"></script>
        <script src="data/RemanescentedeVegetaoNativa_7.js"></script>
        <script src="data/readeEquipamentosPblicos_8.js"></script>
        <script src="data/Ruas_9.js"></script>
        <script src="data/reaVerde_10.js"></script>
        <script src="data/Terrenos_11.js"></script>
        <script src="data/DiagnsticoAmbientalCamposNovos_12.js"></script>
        <script src="data/readeInflunciaDireta_13.js"></script>
        <script src="data/reasdeConflito_14.js"></script>
        <script src="data/CurvadeNvel_16.js"></script>
        <script src="data/reaMatrcula_17.js"></script>
        <script>
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[-27.396306663409735,-51.24312863618227],[-27.392253062055268,-51.23427277420706]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // modify popup if contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true;
                    video.src = src;
                    video.style.width = "400px";
                    video.style.height = "300px";
                    video.style.maxHeight = "60vh";
                    video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    // Aggiorna il popup quando il video carica i metadati
                    video.addEventListener('loadedmetadata', function() {
                        popup.update();
                    });
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);

        // Medi√ß√£o (r√©gua)
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';

        // Bot√£o Home (casinha) - enquadra a camada "√Årea Matr√≠cula"
        var homeControl = L.control({ position: 'topleft' });
        homeControl.onAdd = function () {
            var div = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom-home');
            div.setAttribute('title', 'Recentralizar (√Årea Matr√≠cula)');
            div.innerHTML = 'üè†';
            L.DomEvent.disableClickPropagation(div);
            div.onclick = function () {
                try {
                    map.fitBounds(layer_reaMatrcula_17.getBounds(), { padding: [20, 20] });
                } catch (err) {
                    // fallback: n√£o faz nada se a camada ainda n√£o estiver dispon√≠vel
                }
            };
            return div;
        };
        homeControl.addTo(map);

        // Geolocaliza√ß√£o (fica abaixo do bot√£o home)
        var locateControl = L.control.locate({ locateOptions: { maxZoom: 19 } });
        locateControl.addTo(map);

        // ===== COMERCIAL (toggle no menu) =====
        var layer_Comercial = L.layerGroup(); // n√£o adiciona ao mapa por padr√£o (fica desligado)

        // V√≠deo de teste (YouTube embed)
        var VIDEO_TESTE = "https://www.youtube.com/embed/5iG9Fz3XerA";

        
        function toWatchUrl(url){
            if(!url) return url;
            // youtu.be/<id>
            url = url.replace(/^https?:\/\/youtu\.be\//i, 'https://www.youtube.com/watch?v=');
            // youtube-nocookie embed
            url = url.replace('https://www.youtube-nocookie.com/embed/', 'https://www.youtube.com/watch?v=');
            // youtube embed
            url = url.replace('https://www.youtube.com/embed/', 'https://www.youtube.com/watch?v=');
            return url;
        }

        function openVideoModal(url, titleText){
            // Quando o mapa √© aberto via "file://", o YouTube costuma bloquear iframe (erro 153).
            // Nesse caso, abrimos em nova aba no formato watch.
            if (window.location && window.location.protocol === 'file:') {
                window.open(toWatchUrl(url), "_blank", "noopener");
                return;
            }

            var modal = document.getElementById('videoModal');
            var frame = document.getElementById('videoModalFrame');
            var titleEl = document.getElementById('videoModalTitle');

            // Se por algum motivo n√£o existir modal/iframe, abre em nova aba
            if(!modal || !frame) {
                window.open(toWatchUrl(url), "_blank", "noopener");
                return;
            }

            if(titleEl) titleEl.textContent = titleText || "Vista do lote";
            frame.src = url; // aqui pode ser /embed/
            modal.style.display = 'block';
            modal.setAttribute('aria-hidden', 'false');
        }
function closeVideoModal(){
            var modal = document.getElementById('videoModal');
            var frame = document.getElementById('videoModalFrame');
            if(frame) frame.src = "";
            if(modal){
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
            }
        }

        // Eventos do modal
        (function(){
            var modal = document.getElementById('videoModal');
            if(!modal) return;
            var closeBtn = document.getElementById('videoModalClose');
            var backdrop = modal.querySelector('.video-modal-backdrop');
            if(closeBtn) closeBtn.addEventListener('click', closeVideoModal);
            if(backdrop) backdrop.addEventListener('click', closeVideoModal);
            document.addEventListener('keydown', function(e){
                if(e.key === 'Escape' && modal.style.display === 'block') closeVideoModal();
            });
        })();

        // Clique em bot√µes de v√≠deo (delega√ß√£o)
        document.addEventListener('click', function(e){
            var btn = e.target && e.target.closest ? e.target.closest('.lote-video-btn button') : null;
            if(!btn) return;
            e.preventDefault();
            e.stopPropagation();
            openVideoModal(btn.dataset.url, btn.dataset.title);
        }, true);


        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_GoogleHybrid_0');
        map.getPane('pane_GoogleHybrid_0').style.zIndex = 400;
        var layer_GoogleHybrid_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleHybrid_0',
            opacity: 1.0,
            attribution: '<a href="https://www.google.at/permissions/geoguidelines/attr-guide.html">Map data ¬©2015 Google</a>',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 20
        });
        layer_GoogleHybrid_0;
        map.addLayer(layer_GoogleHybrid_0);
        map.createPane('pane_ortomosaico_15cm_1');
        map.getPane('pane_ortomosaico_15cm_1').style.zIndex = 401;
        var img_ortomosaico_15cm_1 = 'data/ortomosaico_15cm_1.png';
        var img_bounds_ortomosaico_15cm_1 = [[-27.398264531728977,-51.24451191808862],[-27.39124094601967,-51.23510341502459]];
        var layer_ortomosaico_15cm_1 = new L.imageOverlay(img_ortomosaico_15cm_1,
                                              img_bounds_ortomosaico_15cm_1,
                                              {pane: 'pane_ortomosaico_15cm_1'});
        bounds_group.addLayer(layer_ortomosaico_15cm_1);
        map.addLayer(layer_ortomosaico_15cm_1);
        function pop_BaciaRioSantaCruz_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['cod_otto'] !== null ? autolinker.link(String(feature.properties['cod_otto']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['niv_otto'] !== null ? autolinker.link(String(feature.properties['niv_otto']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['nome_bacia'] !== null ? autolinker.link(String(feature.properties['nome_bacia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['curso_prin'] !== null ? autolinker.link(String(feature.properties['curso_prin']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['princ_aflu'] !== null ? autolinker.link(String(feature.properties['princ_aflu']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['sub_bacias'] !== null ? autolinker.link(String(feature.properties['sub_bacias']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['suprabacia'] !== null ? autolinker.link(String(feature.properties['suprabacia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ordem_hstr'] !== null ? autolinker.link(String(feature.properties['ordem_hstr']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ordem_grav'] !== null ? autolinker.link(String(feature.properties['ordem_grav']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['area_total'] !== null ? autolinker.link(String(feature.properties['area_total']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['area_terri'] !== null ? autolinker.link(String(feature.properties['area_terri']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['compcursop'] !== null ? autolinker.link(String(feature.properties['compcursop']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['numcursos'] !== null ? autolinker.link(String(feature.properties['numcursos']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['compcursos'] !== null ? autolinker.link(String(feature.properties['compcursos']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['cmedcursos'] !== null ? autolinker.link(String(feature.properties['cmedcursos']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dens_hidro'] !== null ? autolinker.link(String(feature.properties['dens_hidro']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dens_drena'] !== null ? autolinker.link(String(feature.properties['dens_drena']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['coef_manut'] !== null ? autolinker.link(String(feature.properties['coef_manut']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['distfozlc'] !== null ? autolinker.link(String(feature.properties['distfozlc']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['distnasclc'] !== null ? autolinker.link(String(feature.properties['distnasclc']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['popul_2010'] !== null ? autolinker.link(String(feature.properties['popul_2010']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dispohidri'] !== null ? autolinker.link(String(feature.properties['dispohidri']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_total'] !== null ? autolinker.link(String(feature.properties['dem_total']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_humurb'] !== null ? autolinker.link(String(feature.properties['dem_humurb']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_humrur'] !== null ? autolinker.link(String(feature.properties['dem_humrur']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_ind_tr'] !== null ? autolinker.link(String(feature.properties['dem_ind_tr']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_minera'] !== null ? autolinker.link(String(feature.properties['dem_minera']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_termel'] !== null ? autolinker.link(String(feature.properties['dem_termel']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_animal'] !== null ? autolinker.link(String(feature.properties['dem_animal']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['dem_irriga'] !== null ? autolinker.link(String(feature.properties['dem_irriga']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_BaciaRioSantaCruz_2_0() {
            return {
                pane: 'pane_BaciaRioSantaCruz_2',
                opacity: 0.5,
                color: 'rgba(38,89,128,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(55,126,184,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_BaciaRioSantaCruz_2');
        map.getPane('pane_BaciaRioSantaCruz_2').style.zIndex = 402;
        map.getPane('pane_BaciaRioSantaCruz_2').style['mix-blend-mode'] = 'normal';
        var layer_BaciaRioSantaCruz_2 = new L.geoJson(json_BaciaRioSantaCruz_2, {
            attribution: '',
            interactive: false,
            dataVar: 'json_BaciaRioSantaCruz_2',
            layerName: 'layer_BaciaRioSantaCruz_2',
            pane: 'pane_BaciaRioSantaCruz_2',
            onEachFeature: pop_BaciaRioSantaCruz_2,
            style: style_BaciaRioSantaCruz_2_0,
        });
        bounds_group.addLayer(layer_BaciaRioSantaCruz_2);
        function pop_Cursosdgua_3(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['COCURSODAG'] !== null ? autolinker.link(String(feature.properties['COCURSODAG']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['COCDACOSTA'] !== null ? autolinker.link(String(feature.properties['COCDACOSTA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['CODOM'] !== null ? autolinker.link(String(feature.properties['CODOM']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['COCDADESAG'] !== null ? autolinker.link(String(feature.properties['COCDADESAG']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUCOMPCDA'] !== null ? autolinker.link(String(feature.properties['NUCOMPCDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUTRJUS'] !== null ? autolinker.link(String(feature.properties['NUTRJUS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUTRMON'] !== null ? autolinker.link(String(feature.properties['NUTRMON']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUTRAFL'] !== null ? autolinker.link(String(feature.properties['NUTRAFL']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUDISTBACC'] !== null ? autolinker.link(String(feature.properties['NUDISTBACC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUAREABACC'] !== null ? autolinker.link(String(feature.properties['NUAREABACC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUORDEMCDA'] !== null ? autolinker.link(String(feature.properties['NUORDEMCDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NUNIVOTCDA'] !== null ? autolinker.link(String(feature.properties['NUNIVOTCDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NULONDECDA'] !== null ? autolinker.link(String(feature.properties['NULONDECDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NULATDECDA'] !== null ? autolinker.link(String(feature.properties['NULATDECDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NULONPACDA'] !== null ? autolinker.link(String(feature.properties['NULONPACDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NULATPACDA'] !== null ? autolinker.link(String(feature.properties['NULATPACDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['DTVERSAO'] !== null ? autolinker.link(String(feature.properties['DTVERSAO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['COCDA'] !== null ? autolinker.link(String(feature.properties['COCDA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['SHAPE_LENG'] !== null ? autolinker.link(String(feature.properties['SHAPE_LENG']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Cursosdgua_3_0() {
            return {
                pane: 'pane_Cursosdgua_3',
                opacity: 0.5,
                color: 'rgba(0,74,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: false,
            }
        }
        map.createPane('pane_Cursosdgua_3');
        map.getPane('pane_Cursosdgua_3').style.zIndex = 403;
        map.getPane('pane_Cursosdgua_3').style['mix-blend-mode'] = 'normal';
        var layer_Cursosdgua_3 = new L.geoJson(json_Cursosdgua_3, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Cursosdgua_3',
            layerName: 'layer_Cursosdgua_3',
            pane: 'pane_Cursosdgua_3',
            onEachFeature: pop_Cursosdgua_3,
            style: style_Cursosdgua_3_0,
        });
        bounds_group.addLayer(layer_Cursosdgua_3);
        function pop_VegetaoAtual_4(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['√Årea (ha)'] !== null ? autolinker.link(String(feature.properties['√Årea (ha)']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_VegetaoAtual_4_0() {
            return {
                pane: 'pane_VegetaoAtual_4',
                opacity: 0.5,
                color: 'rgba(56,128,54,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(51,115,49,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_VegetaoAtual_4');
        map.getPane('pane_VegetaoAtual_4').style.zIndex = 404;
        map.getPane('pane_VegetaoAtual_4').style['mix-blend-mode'] = 'normal';
        var layer_VegetaoAtual_4 = new L.geoJson(json_VegetaoAtual_4, {
            attribution: '',
            interactive: false,
            dataVar: 'json_VegetaoAtual_4',
            layerName: 'layer_VegetaoAtual_4',
            pane: 'pane_VegetaoAtual_4',
            onEachFeature: pop_VegetaoAtual_4,
            style: style_VegetaoAtual_4_0,
        });
        bounds_group.addLayer(layer_VegetaoAtual_4);
        function pop_APP_5(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['√Årea (ha)'] !== null ? autolinker.link(String(feature.properties['√Årea (ha)']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_APP_5_0() {
            return {
                pane: 'pane_APP_5',
                opacity: 0.5,
                color: 'rgba(38,89,128,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(55,76,184,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_APP_5');
        map.getPane('pane_APP_5').style.zIndex = 405;
        map.getPane('pane_APP_5').style['mix-blend-mode'] = 'normal';
        var layer_APP_5 = new L.geoJson(json_APP_5, {
            attribution: '',
            interactive: false,
            dataVar: 'json_APP_5',
            layerName: 'layer_APP_5',
            pane: 'pane_APP_5',
            onEachFeature: pop_APP_5,
            style: style_APP_5_0,
        });
        bounds_group.addLayer(layer_APP_5);
        function pop_readeSupressodeVegetao_6(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['√Årea (ha)'] !== null ? autolinker.link(String(feature.properties['√Årea (ha)']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_readeSupressodeVegetao_6_0() {
            return {
                pane: 'pane_readeSupressodeVegetao_6',
                opacity: 0.5,
                color: 'rgba(247,225,55,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(255,255,51,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_readeSupressodeVegetao_6');
        map.getPane('pane_readeSupressodeVegetao_6').style.zIndex = 406;
        map.getPane('pane_readeSupressodeVegetao_6').style['mix-blend-mode'] = 'normal';
        var layer_readeSupressodeVegetao_6 = new L.geoJson(json_readeSupressodeVegetao_6, {
            attribution: '',
            interactive: false,
            dataVar: 'json_readeSupressodeVegetao_6',
            layerName: 'layer_readeSupressodeVegetao_6',
            pane: 'pane_readeSupressodeVegetao_6',
            onEachFeature: pop_readeSupressodeVegetao_6,
            style: style_readeSupressodeVegetao_6_0,
        });
        bounds_group.addLayer(layer_readeSupressodeVegetao_6);
        function pop_RemanescentedeVegetaoNativa_7(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['√Årea (ha)'] !== null ? autolinker.link(String(feature.properties['√Årea (ha)']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_RemanescentedeVegetaoNativa_7_0() {
            return {
                pane: 'pane_RemanescentedeVegetaoNativa_7',
                opacity: 0.5,
                color: 'rgba(38,89,128,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(0,219,255,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_RemanescentedeVegetaoNativa_7');
        map.getPane('pane_RemanescentedeVegetaoNativa_7').style.zIndex = 407;
        map.getPane('pane_RemanescentedeVegetaoNativa_7').style['mix-blend-mode'] = 'normal';
        var layer_RemanescentedeVegetaoNativa_7 = new L.geoJson(json_RemanescentedeVegetaoNativa_7, {
            attribution: '',
            interactive: false,
            dataVar: 'json_RemanescentedeVegetaoNativa_7',
            layerName: 'layer_RemanescentedeVegetaoNativa_7',
            pane: 'pane_RemanescentedeVegetaoNativa_7',
            onEachFeature: pop_RemanescentedeVegetaoNativa_7,
            style: style_RemanescentedeVegetaoNativa_7_0,
        });
        bounds_group.addLayer(layer_RemanescentedeVegetaoNativa_7);
        function pop_readeEquipamentosPblicos_8(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['√Årea (ha)'] !== null ? autolinker.link(String(feature.properties['√Årea (ha)']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_readeEquipamentosPblicos_8_0() {
            return {
                pane: 'pane_readeEquipamentosPblicos_8',
                opacity: 0.5,
                color: 'rgba(128,62,0,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(255,127,0,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_readeEquipamentosPblicos_8');
        map.getPane('pane_readeEquipamentosPblicos_8').style.zIndex = 408;
        map.getPane('pane_readeEquipamentosPblicos_8').style['mix-blend-mode'] = 'normal';
        var layer_readeEquipamentosPblicos_8 = new L.geoJson(json_readeEquipamentosPblicos_8, {
            attribution: '',
            interactive: false,
            dataVar: 'json_readeEquipamentosPblicos_8',
            layerName: 'layer_readeEquipamentosPblicos_8',
            pane: 'pane_readeEquipamentosPblicos_8',
            onEachFeature: pop_readeEquipamentosPblicos_8,
            style: style_readeEquipamentosPblicos_8_0,
        });
        bounds_group.addLayer(layer_readeEquipamentosPblicos_8);
        function pop_Ruas_9(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Ruas_9_0() {
            return {
                pane: 'pane_Ruas_9',
                opacity: 0.5,
                color: 'rgba(85,85,85,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(206,206,206,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Ruas_9');
        map.getPane('pane_Ruas_9').style.zIndex = 409;
        map.getPane('pane_Ruas_9').style['mix-blend-mode'] = 'normal';
        var layer_Ruas_9 = new L.geoJson(json_Ruas_9, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Ruas_9',
            layerName: 'layer_Ruas_9',
            pane: 'pane_Ruas_9',
            onEachFeature: pop_Ruas_9,
            style: style_Ruas_9_0,
        });
        bounds_group.addLayer(layer_Ruas_9);
        function pop_reaVerde_10(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['√Årea (ha)'] !== null ? autolinker.link(String(feature.properties['√Årea (ha)']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_reaVerde_10_0() {
            return {
                pane: 'pane_reaVerde_10',
                opacity: 0.5,
                color: 'rgba(56,128,54,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(77,175,74,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_reaVerde_10');
        map.getPane('pane_reaVerde_10').style.zIndex = 410;
        map.getPane('pane_reaVerde_10').style['mix-blend-mode'] = 'normal';
        var layer_reaVerde_10 = new L.geoJson(json_reaVerde_10, {
            attribution: '',
            interactive: false,
            dataVar: 'json_reaVerde_10',
            layerName: 'layer_reaVerde_10',
            pane: 'pane_reaVerde_10',
            onEachFeature: pop_reaVerde_10,
            style: style_reaVerde_10_0,
        });
        bounds_group.addLayer(layer_reaVerde_10);
        function pop_Terrenos_11(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Name'] !== null ? autolinker.link(String(feature.properties['Name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['descriptio'] !== null ? autolinker.link(String(feature.properties['descriptio']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['timestamp'] !== null ? autolinker.link(String(feature.properties['timestamp']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['begin'] !== null ? autolinker.link(String(feature.properties['begin']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['end'] !== null ? autolinker.link(String(feature.properties['end']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['altitudeMo'] !== null ? autolinker.link(String(feature.properties['altitudeMo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['tessellate'] !== null ? autolinker.link(String(feature.properties['tessellate']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['extrude'] !== null ? autolinker.link(String(feature.properties['extrude']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['visibility'] !== null ? autolinker.link(String(feature.properties['visibility']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['drawOrder'] !== null ? autolinker.link(String(feature.properties['drawOrder']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['icon'] !== null ? autolinker.link(String(feature.properties['icon']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['descript_1'] !== null ? autolinker.link(String(feature.properties['descript_1']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['altitude_1'] !== null ? autolinker.link(String(feature.properties['altitude_1']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['layer'] !== null ? autolinker.link(String(feature.properties['layer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['path'] !== null ? autolinker.link(String(feature.properties['path']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Terrenos_11_0() {
            return {
                pane: 'pane_Terrenos_11',
                opacity: 1,
                color: 'rgba(250,255,57,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 1,
                interactive: false,
            }
        }
        map.createPane('pane_Terrenos_11');
        map.getPane('pane_Terrenos_11').style.zIndex = 411;
        map.getPane('pane_Terrenos_11').style['mix-blend-mode'] = 'normal';
        var layer_Terrenos_11 = new L.geoJson(json_Terrenos_11, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Terrenos_11',
            layerName: 'layer_Terrenos_11',
            pane: 'pane_Terrenos_11',
            onEachFeature: pop_Terrenos_11,
            style: style_Terrenos_11_0,
        });
        bounds_group.addLayer(layer_Terrenos_11);
        // ===== COMERCIAL: bot√£o de v√≠deo em um lote (teste) =====
        (function criarBotaoComercialTeste(){
            try{
                var loteEscolhido = null;
                layer_Terrenos_11.eachLayer(function(l){
                    if(!loteEscolhido && l && l.getBounds) loteEscolhido = l;
                });
                if(!loteEscolhido) return;

                var center = (loteEscolhido.getCenter ? loteEscolhido.getCenter() : loteEscolhido.getBounds().getCenter());
                var markerBtn = L.marker(center, {
                    icon: L.divIcon({
                        className: 'lote-video-btn',
                        html: '<button type="button" data-url="' + VIDEO_TESTE + '" data-title="Vista do lote (teste)">‚ñ∂ V√≠deo</button>',
                        iconSize: [1, 1]
                    }),
                    interactive: true
                });
                layer_Comercial.addLayer(markerBtn);
            } catch(err){
                // se algo falhar, n√£o interrompe o mapa
                console.warn("Comercial (teste) n√£o foi criado:", err);
            }
        })();

        function pop_DiagnsticoAmbientalCamposNovos_12(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Layer'] !== null ? autolinker.link(String(feature.properties['Layer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['PaperSpace'] !== null ? autolinker.link(String(feature.properties['PaperSpace']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['SubClasses'] !== null ? autolinker.link(String(feature.properties['SubClasses']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Linetype'] !== null ? autolinker.link(String(feature.properties['Linetype']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['EntityHandle'] !== null ? autolinker.link(String(feature.properties['EntityHandle']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Text'] !== null ? autolinker.link(String(feature.properties['Text']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_DiagnsticoAmbientalCamposNovos_12_0() {
            return {
                pane: 'pane_DiagnsticoAmbientalCamposNovos_12',
                opacity: 0.5,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: false,
            }
        }
        map.createPane('pane_DiagnsticoAmbientalCamposNovos_12');
        map.getPane('pane_DiagnsticoAmbientalCamposNovos_12').style.zIndex = 412;
        map.getPane('pane_DiagnsticoAmbientalCamposNovos_12').style['mix-blend-mode'] = 'normal';
        var layer_DiagnsticoAmbientalCamposNovos_12 = new L.geoJson(json_DiagnsticoAmbientalCamposNovos_12, {
            attribution: '',
            interactive: false,
            dataVar: 'json_DiagnsticoAmbientalCamposNovos_12',
            layerName: 'layer_DiagnsticoAmbientalCamposNovos_12',
            pane: 'pane_DiagnsticoAmbientalCamposNovos_12',
            onEachFeature: pop_DiagnsticoAmbientalCamposNovos_12,
            style: style_DiagnsticoAmbientalCamposNovos_12_0,
        });
        bounds_group.addLayer(layer_DiagnsticoAmbientalCamposNovos_12);
        function pop_readeInflunciaDireta_13(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['X'] !== null ? autolinker.link(String(feature.properties['X']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Y'] !== null ? autolinker.link(String(feature.properties['Y']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_readeInflunciaDireta_13_0() {
            return {
                pane: 'pane_readeInflunciaDireta_13',
                opacity: 0.5,
                color: 'rgba(128,14,16,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(228,26,28,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_readeInflunciaDireta_13');
        map.getPane('pane_readeInflunciaDireta_13').style.zIndex = 413;
        map.getPane('pane_readeInflunciaDireta_13').style['mix-blend-mode'] = 'normal';
        var layer_readeInflunciaDireta_13 = new L.geoJson(json_readeInflunciaDireta_13, {
            attribution: '',
            interactive: false,
            dataVar: 'json_readeInflunciaDireta_13',
            layerName: 'layer_readeInflunciaDireta_13',
            pane: 'pane_readeInflunciaDireta_13',
            onEachFeature: pop_readeInflunciaDireta_13,
            style: style_readeInflunciaDireta_13_0,
        });
        bounds_group.addLayer(layer_readeInflunciaDireta_13);
        function pop_reasdeConflito_14(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['√Årea (ha)'] !== null ? autolinker.link(String(feature.properties['√Årea (ha)']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_reasdeConflito_14_0() {
            return {
                pane: 'pane_reasdeConflito_14',
                opacity: 0.5,
                color: 'rgba(128,14,16,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.5,
                fillColor: 'rgba(228,26,28,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_reasdeConflito_14');
        map.getPane('pane_reasdeConflito_14').style.zIndex = 414;
        map.getPane('pane_reasdeConflito_14').style['mix-blend-mode'] = 'normal';
        var layer_reasdeConflito_14 = new L.geoJson(json_reasdeConflito_14, {
            attribution: '',
            interactive: false,
            dataVar: 'json_reasdeConflito_14',
            layerName: 'layer_reasdeConflito_14',
            pane: 'pane_reasdeConflito_14',
            onEachFeature: pop_reasdeConflito_14,
            style: style_reasdeConflito_14_0,
        });
        bounds_group.addLayer(layer_reasdeConflito_14);
        map.createPane('pane_Declividade_15');
        map.getPane('pane_Declividade_15').style.zIndex = 415;
        var img_Declividade_15 = 'data/Declividade_15.png';
        var img_bounds_Declividade_15 = [[-27.39726865655879,-51.24375144545729],[-27.391559374293774,-51.23576054829052]];
        var layer_Declividade_15 = new L.imageOverlay(img_Declividade_15,
                                              img_bounds_Declividade_15,
                                              {pane: 'pane_Declividade_15'});
        bounds_group.addLayer(layer_Declividade_15);
        function pop_CurvadeNvel_16(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ID'] !== null ? autolinker.link(String(feature.properties['ID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ELEV'] !== null ? autolinker.link(String(feature.properties['ELEV']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }
        function style_CurvadeNvel_16_0(feature) {
            var context = {
                feature: feature,
                variables: {}
            };
            // Start of if blocks and style check logic
            if (exp_CurvadeNvel_16rule0_eval_expression(context)) {
                  return {
                pane: 'pane_CurvadeNvel_16',
                opacity: 0.5,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '8.0,4.0,2.0,4.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 2.0,
                fillOpacity: 0,
                interactive: false,
            };
                }
                else if (exp_CurvadeNvel_16rule1_eval_expression(context)) {
                  return {
                pane: 'pane_CurvadeNvel_16',
                opacity: 0.5,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: false,
            };
                }
            else {
                return {fill: false, stroke: false};
            }
        }
        map.createPane('pane_CurvadeNvel_16');
        map.getPane('pane_CurvadeNvel_16').style.zIndex = 416;
        map.getPane('pane_CurvadeNvel_16').style['mix-blend-mode'] = 'normal';
        var layer_CurvadeNvel_16 = new L.geoJson(json_CurvadeNvel_16, {
            attribution: '',
            interactive: false,
            dataVar: 'json_CurvadeNvel_16',
            layerName: 'layer_CurvadeNvel_16',
            pane: 'pane_CurvadeNvel_16',
            onEachFeature: pop_CurvadeNvel_16,
            style: style_CurvadeNvel_16_0,
        });
        bounds_group.addLayer(layer_CurvadeNvel_16);
        function pop_reaMatrcula_17(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_reaMatrcula_17_0() {
            return {
                pane: 'pane_reaMatrcula_17',
                opacity: 1,
                color: 'rgba(163,19,20,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 6.0,
                fillOpacity: 0,
                interactive: false,
            }
        }
        map.createPane('pane_reaMatrcula_17');
        map.getPane('pane_reaMatrcula_17').style.zIndex = 417;
        map.getPane('pane_reaMatrcula_17').style['mix-blend-mode'] = 'normal';
        var layer_reaMatrcula_17 = new L.geoJson(json_reaMatrcula_17, {
            attribution: '',
            interactive: false,
            dataVar: 'json_reaMatrcula_17',
            layerName: 'layer_reaMatrcula_17',
            pane: 'pane_reaMatrcula_17',
            onEachFeature: pop_reaMatrcula_17,
            style: style_reaMatrcula_17_0,
        });
        bounds_group.addLayer(layer_reaMatrcula_17);
        map.addLayer(layer_reaMatrcula_17);
        var overlaysTree = [

            {label: '<b>Comercial</b>', collapsed: false, selectAllCheckbox: false, children: [
                {label: 'Vista do lote (v√≠deo)', layer: layer_Comercial},
            ]},

            {label: '<img src="legend/reaMatrcula_17.png" /> √Årea Matr√≠cula', layer: layer_reaMatrcula_17},
        {label: '<b>Topografia</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: 'Curva de N√≠vel<br /><table><tr><td style="text-align: center;"><img src="legend/CurvadeNvel_16_0.png" /></td><td></td></tr><tr><td style="text-align: center;"><img src="legend/CurvadeNvel_16_1.png" /></td><td></td></tr></table>', layer: layer_CurvadeNvel_16},
            {label: "Declividade", layer: layer_Declividade_15},]},
        {label: '<b>Elementos Ambientais</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/reasdeConflito_14.png" /> √Åreas de Conflito', layer: layer_reasdeConflito_14},
            {label: '<img src="legend/readeInflunciaDireta_13.png" /> √Årea de Influ√™ncia Direta', layer: layer_readeInflunciaDireta_13},
            {label: '<img src="legend/DiagnsticoAmbientalCamposNovos_12.png" /> Diagn√≥stico Ambiental Campos Novos', layer: layer_DiagnsticoAmbientalCamposNovos_12},]},
        {label: '<b>Infraestrutura</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/Terrenos_11.png" /> Terrenos', layer: layer_Terrenos_11},
            {label: '<img src="legend/reaVerde_10.png" /> √Årea Verde', layer: layer_reaVerde_10},
            {label: '<img src="legend/Ruas_9.png" /> Ruas', layer: layer_Ruas_9},
            {label: '<img src="legend/readeEquipamentosPblicos_8.png" /> √Årea de Equipamentos P√∫blicos', layer: layer_readeEquipamentosPblicos_8},
            {label: '<img src="legend/RemanescentedeVegetaoNativa_7.png" /> Remanescente de Vegeta√ß√£o Nativa', layer: layer_RemanescentedeVegetaoNativa_7},]},
        {label: '<b>Vegeta√ß√£o</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/readeSupressodeVegetao_6.png" /> √Årea de Supress√£o de Vegeta√ß√£o', layer: layer_readeSupressodeVegetao_6},
            {label: '<img src="legend/APP_5.png" /> APP', layer: layer_APP_5},
            {label: '<img src="legend/VegetaoAtual_4.png" /> Vegeta√ß√£o Atual', layer: layer_VegetaoAtual_4},]},
        {label: '<b>Hidrografia</b>', collapsed: true, selectAllCheckbox: true, children: [
            {label: '<img src="legend/Cursosdgua_3.png" /> Cursos d\'√Ågua', layer: layer_Cursosdgua_3},
            {label: '<img src="legend/BaciaRioSantaCruz_2.png" /> Bacia Rio Santa Cruz', layer: layer_BaciaRioSantaCruz_2},]},
            {label: "ortomosaico_15cm", layer: layer_ortomosaico_15cm_1},
            {label: "Google Hybrid", layer: layer_GoogleHybrid_0},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        var i = 0;
        layer_CurvadeNvel_16.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['ELEV'] !== null?String('<div style="color: #323232; font-size: 10pt; font-weight: bold; font-family: \'Arial\', sans-serif;">' + layer.feature.properties['ELEV']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_CurvadeNvel_16'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        L.ImageOverlay.include({
            getBounds: function () {
                return this._bounds;
            }
        });
        resetLabels([layer_CurvadeNvel_16]);
        map.on("zoomend", function(){
            resetLabels([layer_CurvadeNvel_16]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_CurvadeNvel_16]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_CurvadeNvel_16]);
        });

        /* ECO MAP - comportamento do t√≠tulo e legenda (anti-sobreposi√ß√£o + minimizar) */
        (function () {
            var titleEl = document.getElementById('map-title');
            var legendEl = document.getElementById('legend-declividade');
            var legendBody = document.getElementById('legend-body');
            var toggleBtn = document.getElementById('legend-toggle');
            var logoEl = document.getElementById('logo-ecomap');

            function anyLayerTreeExpanded() {
                return !!document.querySelector('.leaflet-control-layers-tree .expanded')
                    || !!document.querySelector('.leaflet-control-layers-tree .leaflet-layerstree-expanded')
                    || !!document.querySelector('.leaflet-control-layers-tree .leaflet-layerstree-node.leaflet-layerstree-expanded')
                    || !!document.querySelector('.leaflet-control-layers-tree li.expanded')
                    || !!document.querySelector('.leaflet-control-layers-tree li.leaflet-layerstree-expanded');
            }

            function refreshTitleVisibility() {
                if (!titleEl) return;
                titleEl.style.display = anyLayerTreeExpanded() ? 'none' : 'block';
            }

            function setLegendAboveLogo() {
                if (!legendEl || !logoEl) return;
                var gap = (window.innerWidth <= 768) ? 10 : 12;
                var logoRect = logoEl.getBoundingClientRect();
                var bottomPx = Math.max((window.innerHeight - logoRect.top) + gap, 60);
                legendEl.style.bottom = bottomPx + 'px';
                legendEl.style.left = (window.innerWidth <= 768) ? '10px' : '14px';
            }

            function setCollapsed(collapsed) {
                if (!legendEl || !legendBody || !toggleBtn) return;
                legendBody.style.display = collapsed ? 'none' : 'block';
                toggleBtn.textContent = collapsed ? '+' : '‚Äì';
                toggleBtn.title = collapsed ? 'Expandir' : 'Minimizar';
                legendEl.dataset.collapsed = collapsed ? '1' : '0';
                setTimeout(setLegendAboveLogo, 0);
            }

            function showLegend(show) {
                if (!legendEl) return;
                legendEl.style.display = show ? 'block' : 'none';
                legendEl.setAttribute('aria-hidden', show ? 'false' : 'true');
                if (show) setLegendAboveLogo();
            }

            // Toggle da legenda
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    var isCollapsed = legendEl && legendEl.dataset.collapsed === '1';
                    setCollapsed(!isCollapsed);
                });
            }

            // Atualiza t√≠tulo ao interagir com o controle de camadas
            document.addEventListener('click', function (e) {
                if (e.target && (e.target.closest && e.target.closest('.leaflet-control-layers-tree'))) {
                    setTimeout(refreshTitleVisibility, 120);
                }
            }, true);

            // Estado inicial do t√≠tulo
            refreshTitleVisibility();

            // Declividade: mostra/oculta legenda quando liga/desliga
            map.on('overlayadd', function (e) {
                if (typeof layer_Declividade_15 !== 'undefined' && e.layer === layer_Declividade_15) {
                    showLegend(true);
                    setCollapsed(false);
                }
            });
            map.on('overlayremove', function (e) {
                if (typeof layer_Declividade_15 !== 'undefined' && e.layer === layer_Declividade_15) {
                    showLegend(false);
                }
            });

            // Recalcula em resize (desktop/mobile)
            window.addEventListener('resize', function(){
                if (legendEl && legendEl.style.display !== 'none') setLegendAboveLogo();
            });

            // Se abrir j√° com declividade ligada
            try {
                if (typeof layer_Declividade_15 !== 'undefined' && map.hasLayer(layer_Declividade_15)) {
                    showLegend(true);
                    setCollapsed(false);
                }
            } catch (err) {}
        })();

</script>        
    
<div id="ecomap-dashboard" class="ecomap-dashboard" aria-label="Material do Empreendimento">
  <div class="dash-header">
    <span>Material do Empreendimento</span>
    <button id="dashToggleBtn" class="dash-toggle" type="button" aria-label="Minimizar dashboard">‚Äì</button>
  </div>
  <div class="dash-body">
    <button id="btnLayoutUrbanistico" class="dash-btn" type="button">üìÑ Baixar Layout Urban√≠stico</button>
    <button id="btnVideoPasseio" class="dash-btn secondary" type="button">üé• V√≠deo ‚Äì Passeio pelo Loteamento</button>
  </div>
</div>


<script id="ecomap-runtime-fixes">
(function(){
  function ready(fn){
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
    else fn();
  }

  function waitForMap(cb){
    var t0 = Date.now();
    (function tick(){
      if (window.map && window.L) return cb();
      if (Date.now()-t0 > 15000) return; // fail silently
      setTimeout(tick, 60);
    })();
  }

  function setupDashboard(){
    var dash = document.getElementById('ecomap-dashboard');
    if (!dash) return;

    var toggle = document.getElementById('dashToggleBtn');
    if (toggle){
      toggle.addEventListener('click', function(e){
        e.preventDefault(); e.stopPropagation();
        var collapsed = dash.classList.toggle('collapsed');
        toggle.textContent = collapsed ? '+' : '‚Äì';
        toggle.setAttribute('aria-label', collapsed ? 'Expandir dashboard' : 'Minimizar dashboard');
      });
    }

    var btnPdf = document.getElementById('btnLayoutUrbanistico');
    if (btnPdf){
      btnPdf.addEventListener('click', function(e){
        e.preventDefault(); e.stopPropagation();
        var url = 'images/Layout Urban√≠stico.pdf';
        window.open(url, '_blank');
      });
    }

    var btnVideo = document.getElementById('btnVideoPasseio');
    if (btnVideo){
      btnVideo.addEventListener('click', function(e){
        e.preventDefault(); e.stopPropagation();
        var url = 'images/1215.mp4';
        window.open(url, '_blank');
      });
    }
  }

  function setupTitleAutoHide(){
    var title = document.getElementById('map-title');
    if (!title) return;

    function setHidden(hidden){
      title.style.display = hidden ? 'none' : '';
    }

    function bind(){
      var ctl = document.querySelector('.leaflet-control-layers');
      if (!ctl) return false;

      var obs = new MutationObserver(function(){
        var expanded =
          ctl.classList.contains('leaflet-control-layers-expanded') ||
          ctl.classList.contains('leaflet-control-layers-open');
        if (window.matchMedia && window.matchMedia('(max-width: 768px)').matches){
          setHidden(expanded);
        }
      });
      obs.observe(ctl, {attributes:true, attributeFilter:['class']});

      var toggle = ctl.querySelector('.leaflet-control-layers-toggle');
      if (toggle){
        toggle.addEventListener('click', function(){
          setTimeout(function(){
            var expanded = ctl.classList.contains('leaflet-control-layers-expanded') || ctl.classList.contains('leaflet-control-layers-open');
            if (window.matchMedia && window.matchMedia('(max-width: 768px)').matches){
              setHidden(expanded);
            }
          }, 0);
        }, true);
      }

      setTimeout(function(){
        if (window.matchMedia && window.matchMedia('(max-width: 768px)').matches){
          setHidden(ctl.classList.contains('leaflet-control-layers-expanded') || ctl.classList.contains('leaflet-control-layers-open'));
        }
      }, 0);

      return true;
    }

    var tries = 0;
    (function loop(){
      tries++;
      if (bind()) return;
      if (tries > 160) return;
      setTimeout(loop, 100);
    })();
  }

  function fixLegendToggleLayout(){
    var legend = document.getElementById('legend-declividade');
    if (!legend) return;

    var header = legend.querySelector('.legend-header');
    var toggle = legend.querySelector('.legend-toggle');
    if (!header){
      header = document.createElement('div');
      header.className = 'legend-header';

      var titleSpan = document.createElement('span');
      titleSpan.className = 'legend-title';
      titleSpan.textContent = 'Declividade';

      if (!toggle){
        toggle = document.createElement('button');
        toggle.className = 'legend-toggle';
        toggle.type = 'button';
        toggle.textContent = '‚Äì';
        toggle.title = 'Minimizar';
      }

      header.appendChild(titleSpan);
      header.appendChild(toggle);

      var body = document.createElement('div');
      body.className = 'legend-body';

      var children = Array.prototype.slice.call(legend.childNodes);
      children.forEach(function(n){ body.appendChild(n); });
      legend.innerHTML = '';
      legend.appendChild(header);
      legend.appendChild(body);
    }

    var btn = legend.querySelector('.legend-toggle');
    if (btn && !btn.dataset.bound){
      btn.dataset.bound = '1';
      btn.addEventListener('click', function(e){
        e.preventDefault(); e.stopPropagation();
        var collapsed = legend.dataset.collapsed === '1' ? false : true;
        legend.dataset.collapsed = collapsed ? '1' : '0';

        var body = legend.querySelector('.legend-body');
        if (body){
          body.style.display = collapsed ? 'none' : '';
        }
        btn.textContent = collapsed ? '+' : '‚Äì';
      }, true);
    }
  }

  function setupCommercialButtons(){
    if (!window.L) return;
    if (!window.layer_Comercial){
      window.layer_Comercial = L.layerGroup();
    }

    function ensureCss(){
      if (document.getElementById('ecomap-video-btn-css')) return;
      var st = document.createElement('style');
      st.id = 'ecomap-video-btn-css';
      st.textContent =
        ".ecomap-video-btn{background:#fff;border:2px solid #2b7bbb;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.20);padding:4px 6px;}"+
        ".ecomap-video-btn div{font-family:Arial,Helvetica,sans-serif;font-size:14px;color:#000;}"+
        "@media (max-width:768px){.ecomap-video-btn div{font-size:13px;}}";
      document.head.appendChild(st);
    }

    function discoverPointGeoJson(){
      var keys = Object.keys(window);
      for (var i=0;i<keys.length;i++){
        var k = keys[i];
        if (k.indexOf('json_') !== 0) continue;
        var v = window[k];
        if (!v || !v.features || !v.features.length) continue;
        var f = v.features[0];
        if (!f || !f.geometry || f.geometry.type !== 'Point') continue;
        var props = f.properties || {};
        if (props.id_lote || (props.quadra && props.lote) || props.Quadra || props.Lote) return v;
      }
      return null;
    }

    function buildButtonsFromGeojson(gj){
      try{ window.layer_Comercial.clearLayers(); }catch(e){}
      if (!gj || !gj.features) return;

      function pad2(x){
        x = String(x || '').trim();
        if (x.length === 1) return '0' + x;
        return x;
      }

      gj.features.forEach(function(ft){
        if (!ft.geometry || ft.geometry.type !== 'Point') return;
        var c = ft.geometry.coordinates;
        if (!c || c.length < 2) return;
        var lng = c[0], lat = c[1];
        var p = ft.properties || {};
        var quad = (p.quadra || p.Quadra || '').toString().trim();
        var lot = (p.lote || p.Lote || '').toString().trim();
        var id = (p.id_lote || p.id || p.ID || '').toString().trim();

        var top = quad, bottom = pad2(lot);
        if (id && (!quad || !lot)){
          var m = id.match(/^([A-Za-z])\s*[-_ ]?\s*(\d+)/);
          if (m){
            top = m[1];
            bottom = pad2(m[2]);
          }else{
            top = id;
            bottom = '';
          }
        }

        var html = '<div style="line-height:1.05; text-align:center;"><div style="font-weight:800;">'+(top||'')+'</div><div style="font-weight:800;">'+(bottom||'')+'</div></div>';
        var icon = L.divIcon({ className:'ecomap-video-btn', html: html, iconSize:[42,42], iconAnchor:[21,21] });
        var mk = L.marker([lat,lng], {icon: icon, interactive:true});
        mk.on('click', function(){
          var url = 'https://youtu.be/5iG9Fz3XerA';
          window.open(url, '_blank');
        });
        window.layer_Comercial.addLayer(mk);
      });
    }

    function tryLoadCandidates(done){
      var candidates = [];
      for (var i=1;i<=40;i++){
        candidates.push('data/Identificacao_lotes_'+i+'.js');
        candidates.push('data/Identificacaolotes_'+i+'.js');
        candidates.push('data/Identificacao_lote_'+i+'.js');
        candidates.push('data/IdentificacaoLotes_'+i+'.js');
      }
      var idx = 0;

      function loadNext(){
        if (idx >= candidates.length) return done(false);
        var src = candidates[idx++];
        var s = document.createElement('script');
        s.src = src;
        s.async = true;
        s.onload = function(){ done(true); };
        s.onerror = function(){ loadNext(); };
        document.body.appendChild(s);
      }
      loadNext();
    }

    ensureCss();

    var gj = discoverPointGeoJson();
    if (gj){ buildButtonsFromGeojson(gj); return; }

    tryLoadCandidates(function(){
      var gj2 = discoverPointGeoJson();
      if (gj2) buildButtonsFromGeojson(gj2);
    });
  }

  function syncInfraOnCommercial(){
    if (!window.map || !window.L || !window.layer_Comercial) return;

    // Layers that belong to "Infraestrutura" group in this project
    var infraLayers = [
      window.layer_Terrenos_11,
      window.layer_reaVerde_10,
      window.layer_Ruas_9,
      window.layer_readeEquipamentosPblicos_8,
      window.layer_RemanescentedeVegetaoNativa_7,
      window.layer_readeUsoPreservadodeVegetao_6,
      window.layer_APP_5,
      window.layer_VegetacaoAtual_4
    ].filter(Boolean);

    var prev = null;

    window.map.on('overlayadd', function(e){
      if (e && e.layer === window.layer_Comercial){
        prev = {};
        infraLayers.forEach(function(l){
          var k = L.stamp(l);
          prev[k] = window.map.hasLayer(l);
          if (!prev[k]) window.map.addLayer(l);
        });
      }
    });

    window.map.on('overlayremove', function(e){
      if (e && e.layer === window.layer_Comercial && prev){
        infraLayers.forEach(function(l){
          var k = L.stamp(l);
          if (prev[k] === false && window.map.hasLayer(l)) window.map.removeLayer(l);
        });
        prev = null;
      }
    });
  }


  ready(function(){
    setupDashboard();
    setupTitleAutoHide();
    fixLegendToggleLayout();
    waitForMap(function(){
      setupCommercialButtons();
      syncInfraOnCommercial();
      setTimeout(fixLegendToggleLayout, 0);
    });
  });
})();
</script>

</body>
</html>
